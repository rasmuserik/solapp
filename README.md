# solapp
[![ci](https://secure.travis-ci.org/rasmuserik/solapp.png)](http://travis-ci.org/rasmuserik/solapp)

TODO: description here

Work in progress, not running yet

# About

## What

Quickly create apps

- edit `APPNAME.coffee`
- run `solapp`
- edit `package.json`
- create icon and screenshot in `meta`-folder
- done

## Usage

    solapp start

Starts devserver for app in current directory

    solapp test

Run tests for app in current directory

    solapp commit some description here

Increment package version, commit, pull, test, push, npm publish


## File structure for projects

Project files:

- APPNAME.coffee - handedited - APPNAME should be the `name` in package.json
- package.json - partly autogenerated, but also handedited
- meta/icon.png - at least 512x512 square icon
- meta/screen1.png - screenshot
- meta/screen2.png - screenshot
- meta/feature.png - 1024x500 banner
- res/* - resources for the app to use/access, will be in the same directory as the app

Generated files
- package.json - handedited and autoupdated
- .gitignore
- .travis.yml
- APPNAME.js - autogenerated from APPNAME.coffee
- README.md - autogenerated from package.json for description and APPNAME.coffee as literate code
- dist/* - various 

## Old notes needing merging

- weekly app
  - $APP/package.json - with meta-data for appstore
  - $APP/$APP.coffee
  - $APP/meta/icon.png 512x512
  - $APP/meta/screen1.png
  - $APP/meta/screen2.png
  - $APP/meta/feature.png 1024x500
  - ($APP/meta/screenN.png)
  - ($APP/meta/demo.webm - short video)
- solapp
  - README.md from package.json, meta/icon+screen+feature, and $APP.coffee
  - require/load/bundle package.dependencies on web
  - .gitignore
  - package.json - update/automake
  - travis.yml
  - compile coffeescript
  - preprocessing
    - `global?.isNodeJs = true if typeof isNodeJs != "boolean" and process?.versions?.node`
    - useful with`uglify-js -d isNodeJs=true -c ...`
  - dist: solsort.com (cache-manifest, add-to-home-screen, ie-pinned-site), android market, mozilla-marketplace, chrome-store (apple app-store, facebook, amazon, windows, blackberry, steam)


# Literate source code

    

## initial stuff

    sa = exports
    global?.isNodeJs = true if typeof isNodeJs != "boolean" and process?.versions?.node
    

## utility functions
### sleep

    sa.sleep = (t,fn) -> setTimeout fn, t * 1000

### nextTick

    sa.nextTick =
      if isNodeJs
        process.nextTick
      else
        (fn) -> setTimeout fn, 0

### readFileSync
abstracted to return empty string on non-existant file, and add the ability to implement on other platforms than node

    sa.readFileSync =
      if isNodeJs
        (filename) ->
          try
            return (require "fs").readFileSync filename, "utf8"
          catch e
            console.log "Warning, couldn't read \"#{filename}\":\n#{e}"
            return ""
       else
         -> throw "sa.readFileSync not implemented on this platform"
    

## autoexpand package.json

    if isNodeJs
      expandPackage = (project) ->
        pkg = (project.package ?= {})
        pkg.fullname ?= pkg.name || project.name
        pkg.author ?= "Rasmus Erik Voel Jensen (solsort.com)"
        pkg.description ?= "TODO: description here"
        pkg.name ?= project.name
        pkg.owner ?= "rasmuserik"
        pkg.version ?= "0.0.1"
        pkg.main ?= pkg.name + ".js"
        pkg.scripts ?= {}
        pkg.scripts.start ?= "node ./node_modules/solapp/solapp.js start"
        pkg.scripts.test ?= "node ./node_modules/solapp/solapp.js test"
        pkg.dependencies ?= {}
        pkg.dependencies.solapp ?= "*" if pkg.name != "solapp"
        pkg.repository =
          type: "git"
          url: "http://github.com/#{pkg.owner}/#{pkg.name}.git"
      

## create README.md

    if isNodeJs
      genReadme = (project) ->
        source = project.source
        pkg = project.package
        result =""
        result += "![#{pkg.name}](https://raw.github.com/#{pkg.owner}/#{pkg.name}/master/meta/feature.png\n" if (require "fs").existsSync "#{project.dirname}/meta/feature.png"
        result += "# #{pkg.fullname || pkg.name}\n"
        result += "[![ci](https://secure.travis-ci.org/#{pkg.owner}/#{pkg.name}.png)](http://travis-ci.org/#{pkg.owner}/#{pkg.name})\n"
        result += "\n#{pkg.description}\n"
      
        for line in source.split("\n")
      
          if (line.search /^\s*#/) == -1
            line = "    " + line
            isCode = true
          else
            line = line.replace /^\s*# ?/, ""
            line = line.replace new RegExp("(.*){{" + "{(\\d)(.*)"), (_, a, header, b) ->
              ("#" for i in [1..+header]).join("") + " " + (a + b).trim()
            isCode = false
      
      
          if isCode != prevWasCode
            result += "\n"
          prevWasCode = isCode
      
          result += line + "\n"
      
        result += "\n\n----\n\nAutogenerated README.md, edit #{pkg.name}.coffee or package.json to update "
        result += "[![repos](https://ssl.solsort.com/_solapp_#{pkg.owner}_#{pkg.name}.png)](https://github.com/#{pkg.owner}/#{pkg.name})\n"
      
        return result
      

## loadProject

    
    loadProject = (dirname) ->
      pkg = JSON.parse (sa.readFileSync dirname + "/package.json") || "{}"
      name = pkg.name || dirname.split("/").slice(-1)[0]
      result =
        dirname: dirname
        name: name
        package: pkg
        source: sa.readFileSync "#{dirname}/#{name}.coffee"
      expandPackage result
      result
    

## Build

    if isNodeJs
      project = loadProject process.cwd()
      build = ->
        console.log "writing package.json"
        (require "fs").writeFile "#{project.dirname}/package.json", "#{JSON.stringify project.package, null, 4}\n", (err) -> throw err if err
        console.log "writing README.md"
        require("fs").writeFileSync "#{project.dirname}/README.md", genReadme project
        console.log "writing #{project.name}.js"
        require("fs").writeFileSync "#{project.name}.js", require("coffee-script").compile(project.source)
    

## Main dispatch

    if isNodeJs and require.main == module
      console.log process.argv
      sa.nextTick ->
        require "coffee-script"
        require("./#{project.name}.coffee").main()
    

# main

    sa.main = (args...)->
      build()
    


----

Autogenerated README.md, edit solapp.coffee or package.json to update [![repos](https://ssl.solsort.com/_solapp_rasmuserik_solapp.png)](https://github.com/rasmuserik/solapp)
